(function(){"use strict";var e={9498:function(e,t,a){var n=a(5130),r=(a(5524),a(7768)),s=a(1920),o=a(5741);const i={dark:!1,colors:{background:"#FFFFFF",surface:"#FFFFFF","surface-bright":"#FFFFFF","surface-light":"#EEEEEE","surface-variant":"#424242","on-surface-variant":"#EEEEEE",primary:"#2c3e50","primary-darken-1":"#1F5592",secondary:"#48A9A6","secondary-darken-1":"#018786",error:"#B00020",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"}};var l=(0,r.$N)({components:s,directives:o,theme:{defaultTheme:"myCustomTheme",themes:{myCustomTheme:i}}}),u=a(6768);function d(e,t,a,r,s,o){const i=(0,u.g2)("v-app");return(0,u.uX)(),(0,u.Wv)(i,null,{default:(0,u.k6)((()=>[(0,u.bF)(n.eB,{name:"fade",mode:"out-in"},{default:(0,u.k6)((()=>[((0,u.uX)(),(0,u.Wv)((0,u.$y)(o.layout)))])),_:1})])),_:1})}var c=a(782);function g(e,t,a,n,r,s){const o=(0,u.g2)("v-progress-circular"),i=(0,u.g2)("v-col"),l=(0,u.g2)("v-container");return(0,u.uX)(),(0,u.Wv)(l,{fluid:"",style:{height:"100vh","align-items":"center",display:"flex"}},{default:(0,u.k6)((()=>[(0,u.bF)(i,{justify:"center",align:"center"},{default:(0,u.k6)((()=>[(0,u.bF)(o,{size:100,width:7,color:"primary",indeterminate:""}),t[0]||(t[0]=(0,u.Lk)("h1",{class:"pa-5"},"Загрузка данных...",-1))])),_:1})])),_:1})}var m={name:"loadLayout",data(){return{}},components:{},methods:{}},h=a(1241);const f=(0,h.A)(m,[["render",g]]);var v=f,p=a(4232);function y(e,t,a,r,s,o){const i=(0,u.g2)("AppBar"),l=(0,u.g2)("v-card-title"),d=(0,u.g2)("v-card-subtitle"),c=(0,u.g2)("TextField"),g=(0,u.g2)("v-card-text"),m=(0,u.g2)("v-btn"),h=(0,u.g2)("v-row"),f=(0,u.g2)("v-card-actions"),v=(0,u.g2)("v-form"),y=(0,u.g2)("v-card"),k=(0,u.g2)("v-container");return(0,u.uX)(),(0,u.CE)("div",null,[(0,u.bF)(i),(0,u.bF)(k,{fluid:"",style:{height:"100vh","align-items":"center",display:"flex"}},{default:(0,u.k6)((()=>[(0,u.bF)(h,{align:"center",justify:"center"},{default:(0,u.k6)((()=>[(0,u.bF)(y,{class:"pt-3 pa-3",elevation:"10",outlined:"",width:"30%","max-width":"500",style:{"border-width":"2px"}},{default:(0,u.k6)((()=>[(0,u.bF)(l,null,{default:(0,u.k6)((()=>t[2]||(t[2]=[(0,u.eW)("Авторизация")]))),_:1}),s.authError?((0,u.uX)(),(0,u.Wv)(d,{key:0,color:"error"},{default:(0,u.k6)((()=>[(0,u.eW)((0,p.v_)(s.errorMessage),1)])),_:1})):(0,u.Q3)("",!0),(0,u.bF)(v,{onSubmit:(0,n.D$)(o.sendLogin,["prevent"])},{default:(0,u.k6)((()=>[(0,u.bF)(g,null,{default:(0,u.k6)((()=>[(0,u.bF)(c,{modelValue:s.authData.username,"onUpdate:modelValue":t[0]||(t[0]=e=>s.authData.username=e),label:"Имя пользователя",type:"text"},null,8,["modelValue"])])),_:1}),(0,u.bF)(g,null,{default:(0,u.k6)((()=>[(0,u.bF)(c,{modelValue:s.authData.password,"onUpdate:modelValue":t[1]||(t[1]=e=>s.authData.password=e),label:"Пароль",type:"Password"},null,8,["modelValue"])])),_:1}),(0,u.bF)(f,null,{default:(0,u.k6)((()=>[(0,u.bF)(h,{align:"end",justify:"end"},{default:(0,u.k6)((()=>[(0,u.bF)(m,{text:"",loading:s.loading,color:"primary",onClick:o.sendAuth},{default:(0,u.k6)((()=>t[3]||(t[3]=[(0,u.eW)(" Создать ")]))),_:1},8,["loading","onClick"]),(0,u.bF)(m,{text:"",loading:s.loading,type:"submit",color:"primary"},{default:(0,u.k6)((()=>t[4]||(t[4]=[(0,u.eW)(" Вход ")]))),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1})])}function k(e,t,a,n,r,s){const o=(0,u.g2)("v-icon"),i=(0,u.g2)("v-spacer"),l=(0,u.g2)("v-row"),d=(0,u.g2)("InfoBlock"),c=(0,u.g2)("v-btn"),g=(0,u.g2)("v-app-bar");return(0,u.uX)(),(0,u.Wv)(g,{app:"",color:"primary",dark:"","clipped-left":"","clipped-right":""},{default:(0,u.k6)((()=>[(0,u.bF)(o,{class:"pr-3","x-large":""},{default:(0,u.k6)((()=>t[0]||(t[0]=[(0,u.eW)("mdi-monitor-multiple")]))),_:1}),(0,u.Lk)("h1",null,(0,p.v_)(r.title),1),(0,u.bF)(l,{align:"center",justify:"space-between"},{default:(0,u.k6)((()=>[(0,u.bF)(i)])),_:1}),null!=e.token?((0,u.uX)(),(0,u.Wv)(d,{key:0},{default:(0,u.k6)((()=>[(0,u.Lk)("h1",null,(0,p.v_)(e.user.username),1)])),_:1})):(0,u.Q3)("",!0),null!=e.token?((0,u.uX)(),(0,u.Wv)(d,{key:1},{default:(0,u.k6)((()=>[(0,u.bF)(c,{text:"",onClick:e.exit,color:"success"},{default:(0,u.k6)((()=>t[1]||(t[1]=[(0,u.eW)(" Выход ")]))),_:1},8,["onClick"])])),_:1})):(0,u.Q3)("",!0)])),_:1})}const b={class:"header-info-slot d-flex flex-column justify-center"};function F(e,t){return(0,u.uX)(),(0,u.CE)("div",b,[(0,u.RG)(e.$slots,"default")])}const _={},w=(0,h.A)(_,[["render",F]]);var x=w,E={data(){return{title:document.title}},components:{InfoBlock:x},methods:{...(0,c.i0)(["exit"])},computed:{...(0,c.L8)({token:"token",user:"user"})}};const M=(0,h.A)(E,[["render",k]]);var A=M;function S(e,t,a,n,r,s){const o=(0,u.g2)("v-text-field");return(0,u.uX)(),(0,u.Wv)(o,(0,u.v6)({outlined:"",dense:""},e.$attrs),null,16)}var W={};const L=(0,h.A)(W,[["render",S]]);var T=L,C={name:"loginLayout",data(){return{authData:{password:"",username:""},loading:!1,authError:!1,errorMessage:""}},methods:{...(0,c.i0)(["login","auth"]),async sendAuth(){this.loading=!0;try{await this.auth(this.authData),this.authError=!1}catch(e){this.authError=!0,this.errorMessage=e.message}this.loading=!1},async sendLogin(){this.loading=!0;try{await this.login(this.authData),this.authError=!1}catch(e){this.authError=!0,this.errorMessage=e.message}this.loading=!1}},components:{TextField:T,AppBar:A}};const X=(0,h.A)(C,[["render",y]]);var j=X;const O={key:0};function D(e,t,a,n,r,s){const o=(0,u.g2)("AppBar"),i=(0,u.g2)("router-view"),l=(0,u.g2)("v-main");return r.loading?(0,u.Q3)("",!0):((0,u.uX)(),(0,u.CE)("div",O,[(0,u.bF)(o),(0,u.bF)(l,null,{default:(0,u.k6)((()=>[(0,u.bF)(i,null,{default:(0,u.k6)((({Component:e})=>[((0,u.uX)(),(0,u.Wv)(u.PR,null,[((0,u.uX)(),(0,u.Wv)((0,u.$y)(e)))],1024))])),_:1})])),_:1})]))}var B={data(){return{loading:!1}},components:{AppBar:A},methods:{...(0,c.i0)(["getUserInfo"])},async mounted(){this.loading=!0,await this.getUserInfo(),this.loading=!1}};const V=(0,h.A)(B,[["render",D]]);var P=V,R={name:"App",data:()=>({loading:!0}),computed:{layout(){return this.loading?"LoadingLayout":null==this.token?"LoginLayout":"MainLayout"},...(0,c.L8)({token:"token"})},methods:{...(0,c.i0)(["refresh"])},components:{LoadingLayout:v,LoginLayout:j,MainLayout:P},async mounted(){await this.refresh(),this.loading=!1}};const U=(0,h.A)(R,[["render",d]]);var $=U,q=a(1387);function I(e,t,a,n,r,s){const o=(0,u.g2)("list-messages"),i=(0,u.g2)("message-field"),l=(0,u.g2)("v-container");return(0,u.uX)(),(0,u.Wv)(l,{class:"chat-container"},{default:(0,u.k6)((()=>[(0,u.bF)(o,{"align-self":"start"}),(0,u.bF)(i)])),_:1})}function z(e,t,a,r,s,o){const i=(0,u.g2)("v-progress-linear"),l=(0,u.g2)("v-text-field"),d=(0,u.g2)("v-form"),c=(0,u.g2)("v-card");return(0,u.uX)(),(0,u.Wv)(c,null,{default:(0,u.k6)((()=>[(0,u.bF)(d,{onSubmit:(0,n.D$)(o.enterSendMessage,["prevent"])},{default:(0,u.k6)((()=>[(0,u.bF)(l,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e),placeholder:"Введите сообщение...",rows:"2","no-resize":"",disabled:s.loading},{loader:(0,u.k6)((()=>[(0,u.bF)(i,{active:s.loading,color:"primary","model-value":o.progress,height:"7",indeterminate:""},null,8,["active","model-value"])])),_:1},8,["modelValue","disabled"])])),_:1},8,["onSubmit"])])),_:1})}var G={name:"messageField",data(){return{value:"",loading:!1}},methods:{...(0,c.i0)(["sendMessage","getAllMessages"]),async enterSendMessage(){this.loading=!0;var e={content:this.value,user_id:this.user.id};console.log("messageData",e),await this.sendMessage(e),await this.getAllMessages(),this.value="",this.loading=!1}},computed:{...(0,c.L8)({user:"user"}),progress(){return Math.min(100,10*this.value.length)}}};const Q=(0,h.A)(G,[["render",z]]);var N=Q;function H(e,t,a,n,r,s){const o=(0,u.g2)("message-vue"),i=(0,u.g2)("v-sheet");return(0,u.uX)(),(0,u.Wv)(i,{class:"chat-messages",elevation:"2"},{default:(0,u.k6)((()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(e.messages,((e,t)=>((0,u.uX)(),(0,u.CE)("div",{key:t},[(0,u.bF)(o,{title:e.user.username,text:e.content,date:e.create_time},null,8,["title","text","date"])])))),128))])),_:1})}function J(e,t,a,n,r,s){const o=(0,u.g2)("v-card-title"),i=(0,u.g2)("v-card-text"),l=(0,u.g2)("v-card");return(0,u.uX)(),(0,u.Wv)(l,{class:"message-card"},{default:(0,u.k6)((()=>[(0,u.bF)(o,{class:"message-text"},{default:(0,u.k6)((()=>[(0,u.eW)((0,p.v_)(a.title),1)])),_:1}),(0,u.bF)(i,{class:"message-text"},{default:(0,u.k6)((()=>[(0,u.eW)((0,p.v_)(a.text),1)])),_:1}),(0,u.bF)(i,{class:"message-text-date"},{default:(0,u.k6)((()=>[(0,u.eW)((0,p.v_)(s.formatDate),1)])),_:1})])),_:1})}var K=a(9740),Y={name:"messageComponent",props:{title:String,text:String,date:String},computed:{formatDate(){return(0,K.GP)(this.date,"yyyy-MM-dd HH:mm:ss")}}};const Z=(0,h.A)(Y,[["render",J]]);var ee=Z,te={name:"listMessages",data(){return{}},computed:{...(0,c.L8)({messages:"messages"})},methods:{...(0,c.i0)(["getAllMessages"]),async updateMessages(){try{await this.getAllMessages()}catch(e){console.error("Ошибка при получении сообщений:",e)}}},components:{MessageVue:ee},async mounted(){await this.getAllMessages(),setInterval(this.updateMessages,2e3)}};const ae=(0,h.A)(te,[["render",H]]);var ne=ae,re={name:"ChatView",components:{MessageField:N,ListMessages:ne}};const se=(0,h.A)(re,[["render",I]]);var oe=se;const ie=[{path:"/",name:"chat",component:oe}],le=(0,q.aE)({history:(0,q.Bt)(),routes:ie});var ue=le,de={state:{token:null,refresh_token:""},mutations:{setToken(e,t){e.token=t?"Bearer "+t:null}},getters:{token(e){return e.token}},actions:{async auth(e,t){let a=await e.dispatch("provideRequest",{endpoint:"/auth/",body:t});return a&&(localStorage.refresh_token=a.refresh_token,e.commit("setToken",a.token)),a},async login(e,t){let a=await e.dispatch("provideRequest",{endpoint:"/login/",body:t});return a&&(localStorage.refresh_token=a.refresh_token,e.commit("setToken",a.token)),a},async refresh(e,t){try{var a=localStorage.refresh_token||null;e.commit("setToken",a);let n=await e.dispatch("provideRequest",{endpoint:"/refresh/",body:t,method:"POST"});n&&(localStorage.refresh_token=n.refresh_token,e.commit("setToken",n.token))}catch{localStorage.clear()}},exit(e){localStorage.clear(),e.commit("setToken",null)}}},ce={state:{user:{id:Number,username:String}},mutations:{setUser(e,t){e.user=t}},getters:{user(e){return e.user}},actions:{async getUserInfo(e){let t=await e.dispatch("provideRequest",{endpoint:"/info/user/",method:"GET"});t&&e.commit("setUser",t)}}},ge={state:{messages:[]},mutations:{setMessages(e,t){e.messages=t}},getters:{messages(e){return e.messages}},actions:{async getAllMessages(e){let t=await e.dispatch("provideRequest",{endpoint:"/messages/",method:"GET"});t&&e.commit("setMessages",t)},async sendMessage(e,t){await e.dispatch("provideRequest",{endpoint:"/messages/",body:t})}}},me=(0,c.y$)({state:{},getters:{},mutations:{},actions:{async provideRequest(e,{endpoint:t,body:a,method:n}){try{let r=await fetch(t,{method:n||"POST",headers:{"Content-Type":"application/json",Authorization:e.getters.token},body:a?JSON.stringify(a):null});if(500==r.status)throw new Error("Ошибка соединения с сервером");let s=await r.json();if(r.ok)return s;if(console.log(r),"Unauthorized"!=s.error_class)throw new Error(s.message);await e.commit("setToken",null),localStorage.clear()}catch(r){throw console.log(r),new Error(r.message)}}},modules:{auth:de,user:ce,messages:ge}});document.title="Webchat",(0,n.Ef)($).use(me).use(ue).use(l).mount("#app")}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,a),s.exports}a.m=e,function(){var e=[];a.O=function(t,n,r,s){if(!n){var o=1/0;for(d=0;d<e.length;d++){n=e[d][0],r=e[d][1],s=e[d][2];for(var i=!0,l=0;l<n.length;l++)(!1&s||o>=s)&&Object.keys(a.O).every((function(e){return a.O[e](n[l])}))?n.splice(l--,1):(i=!1,s<o&&(o=s));if(i){e.splice(d--,1);var u=r();void 0!==u&&(t=u)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,r,s]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,s,o=n[0],i=n[1],l=n[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(l)var d=l(a)}for(t&&t(n);u<o.length;u++)s=o[u],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(d)},n=self["webpackChunkmy_vue3_project"]=self["webpackChunkmy_vue3_project"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[504],(function(){return a(9498)}));n=a.O(n)})();
//# sourceMappingURL=app.f6b5960b.js.map